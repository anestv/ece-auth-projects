
#include "common.h"

const macaddress macAddrList[] = {0x9235d08e69ab, 0x0ef0abe3f96a, 0x47cc2ff51178, 0xdec2be41f22f, 
0xb8400b1f648d, 0x03ad5455465d, 0xe20e46dad05c, 0x3bbd87abf147, 0x1676b8362223, 0x8dde7e032239, 
0x36089ae02fd5, 0xe2771882af92, 0xed2be18be178, 0xb7241086bfa5, 0x8861159a7979, 0x811187e214fc, 
0x71bedee506af, 0x5442663818d8, 0x8abb91640aaa, 0x67755d3d0ee7, 0x46daaf1f90f5, 0x4600dd01b71b, 
0xb670b5695578, 0xac8a62a87efe, 0x60c7cdfaeb6f, 0x60abe1aa06c5, 0x3b63252ffc32, 0x4c8edd75df3d, 
0x4f294272bbf5, 0x58133208920d, 0xe417c90eb164, 0x957098296b48, 0x25413ad3c62f, 0x792d7998cd12, 
0xa91e473cd248, 0x5788ca6e3463, 0x27511deed177, 0xdc4a2000f907, 0xecec89c5eb52, 0x6d61f1f93a76, 
0x7215c626be8a, 0x89a54dbd1699, 0x413f2a875c82, 0x089db4bd8218, 0xbc74aa1d590b, 0x967d0d4b220a, 
0x65eecb7b8e50, 0x1436b82ece7f, 0x70aaba742f65, 0x8edd0eb88184, 0x3c5b9ff21da0, 0xf05a26a51feb, 
0xf848d27e0c8d, 0x88714823129e, 0x638df6b2fca2, 0x760ae7ccdbbf, 0x69557291b296, 0xa333a5fab9e5, 
0x1e06a4025d97, 0x15639071ed00, 0x370a61fca2c6, 0xb041c368f028, 0x4f874de6936f, 0x18925d4fade6, 
0x3a31a275e396, 0x66cf592a747a, 0xa51fc23f13e3, 0x7bceccc4f8db, 0xd54c3b17e938, 0x1a71c7e25584, 
0xc17fa0f16ac3, 0x181601916e68, 0x9c3748965fb9, 0x1eec0b8b3af3, 0x127b0fd8ff72, 0x06232dc70034, 
0x835586d7ceb1, 0x7539546fcbc2, 0xcb6cfcf21254, 0xbb4ffcd95f72, 0x5f23795eeb06, 0x4131573ca338, 
0x106d264aa69d, 0x71c6a3fa11ae, 0x0bf3bc9eaaa7, 0xbd35d3df1020, 0x2f4ecaa2c0ef, 0x9c922908399b, 
0xc808c177a7a1, 0xbdae97fd8ec8, 0xc871fac42e65, 0x7e4f7e9f0123, 0x186c96f68023, 0x11686eaa9284, 
0xe89b4d410a4c, 0x4183196bda57, 0x6448e1d90fff, 0x1053d341bd54, 0x7134432ce429, 0xa13535573325, 
0xe2f6058dfb4c, 0x8a88aac0b1d6, 0xb14065ccd730, 0xb7e0915c5934, 0xa0582f14106c, 0x1b0013956176, 
0x788002dad3ca, 0xb5f53f7120ff, 0x0a5d59f17b5e, 0x64a1ecc087dd, 0xe1f5d0d04e36, 0x3587695126c7, 
0xa0095b7dca8d, 0x2b6df06be702, 0xe80bfd9e1e49, 0x67a69d1cc540, 0x0a2d26dd8f56, 0xf1b1e9249c65, 
0xff9e969b2918, 0xb2f99f111889, 0x161b02ece341, 0xedd0a0ac7e23, 0xe683b487d3e9, 0x30819e7e3e51, 
0xdbf6d8566b7a, 0x42b9b85ed97f, 0x58e8a9f027a0, 0xc678164d88ef, 0xa0b08c9e2a44, 0x62174a5f6081, 
0x0dfc8f9f3592, 0x14e9ebdb1072, 0x353b1a9f9cbe, 0x3b29d30e0bc0, 0xe9a614ccd5c5, 0xcce90c374fc9, 
0x72d9354fd3e0, 0xc32d02d49448, 0xe183e77417a5, 0x2a637e76a5cb, 0xdfe34a669799, 0x8ccf5f9f5096, 
0x86e0378c0f0d, 0x1b9a77014373, 0x488ddda03072, 0x840708de61a4, 0xb1398721cb2d, 0x93dfea6efd65, 
0xc6613adc1f3f, 0xfb41aa8bbd0b, 0x5857cfdc5b3e, 0xbcddadf3399d, 0x9e005231c380, 0xbe3e86942b58, 
0x6169a032fed7, 0xa4d457ea1aea, 0x58313ee54e5e, 0x21e085bdb4f8, 0x21ca86cef48e, 0x41466dc38c0a, 
0xfc4405c15e3e, 0xc242102b0632, 0x65d0a98ad510, 0x671e89fa3d1c, 0x2dd7a528128e, 0x6e7dfea6fe3f, 
0xb32288c4a86d, 0xef12bc93090b, 0x0a98308b7f4f, 0x2271b606f72a, 0x41b37360928a, 0x0d28bcde83bd, 
0x9a373eb21699, 0xdd72e54d0e49, 0xb63360aa80f2, 0x4c9fb928bfb9, 0x1cfc4283a1bc, 0xb5b0dded071a, 
0x50668cbbb094, 0xe85bde89bb64, 0xb716317ee95d, 0x392b761811c0, 0x0f82245d7f87, 0xca8ba90d6a40, 
0x12237d08c1e8, 0x2c94085613d2, 0xb24d06d9871d, 0x4288249349fe, 0x035e1b3f6867, 0x2a3440d52691, 
0xa46f3826e509, 0x218dd310dfa4, 0x963e791e993d, 0xd5830d3f8624, 0x975ec1b7b0cd, 0x0510536454fd, 
0x0fe3f230fe76, 0x0a7222b1480e, 0x01067a9e1ace, 0xe0fefac9ace4 };


bool testCOVID(){
	
	const bool res = rand() < PROB_COVID_POSITIVE * (float) RAND_MAX;
	
	printFuncCall('T', res);
	
	return res;
}

macaddress BTnearMe(){
	/* say we want 300 close contacts in 14 days. There will be 14*24*3600/10 = 120960 scans
	This is 0.25% chance. = 50% * 50% * 1/100 (chance to hit TODO find the maths..... */
	
	const int randi = rand();
	
	macaddress res;
	
	if (rand() < PROB_GET_PRESET_MAC * (float)RAND_MAX ) // a chance to pick from the presets
		res = macAddrList[randi % MAC_PRESET_LIST_LENGTH];
	else
		res = randi;
	
	printFuncCall('B', res);
	
	return res;
}

// Notice: The funtion signature is different than the suggested
void uploadContacts(const closecontact* const closeContacts, const int CClength){
	
	printFuncCall('U', CClength);
	
	char filename[30]; // 10 digits + 10 chars + \0 + extra
	sprintf(filename, "upload%10ld.bin", time(NULL));
	
	FILE *file = fopen(filename, "wb");
	
	if (file == NULL) {
		fprintf(stderr,"Error writing upload to file\n");
		return;
	}

	fwrite(&CClength, sizeof(int), 1, file);
	fwrite(closeContacts, sizeof(closecontact), CClength, file);

	fclose(file);
}

